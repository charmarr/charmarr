name: "Storage K8s: Publish Edge"

on:
  workflow_call:
    inputs:
      dry-run:
        type: boolean
        default: false

jobs:
  quality:
    uses: charmarr/.github/.github/workflows/charm-ci.yaml@v1
    with:
      charm-path: charms/charmarr-storage-k8s

  publish:
    needs: quality
    uses: charmarr/.github/.github/workflows/charm-publish-edge.yaml@v1
    with:
      charm-path: charms/charmarr-storage-k8s
      track: latest
      dry-run: ${{ inputs.dry-run || false }}
      substrate-channel: 1.32/stable
      self-hosted-runner: charmarr-charm-ci
      self-hosted-suites: '["test_native_nfs_backend.py"]'
      concierge-restore: true
      load-nfs-modules: true
    secrets:
      CHARMHUB_TOKEN: ${{ secrets.CHARMHUB_TOKEN }}
